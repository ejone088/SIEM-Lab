# SIEM & RDP LOGIN FAILURES (Microsoft Azure)
I will be creating a VM in the cloud (Microsoft Azure) and using it as a honeypot to draw attackers while using Microsoft Sentinel (SIEM) to observe and visualize log data from the VM as it is attacked.

While creating the Windows VM, I am going to reconfigure the default firewall rule in place and create a new one to open the VM to all traffic on the internet, ensuring that it will be discoverable


<img width="200" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/eee43b8e-93fc-45b3-91df-980ec650750d">


Completed deployment of the Windows VM


<img width="369" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/25acd881-c7b1-4008-ac68-d68a1390bc39">


Created a Log Analytics Workspace to absorb Windows Event logs generated by the VM and make custom logs that capture geographic data of the VM's attackers that will be displayed in Microsoft Sentinel (SIEM) to discover attacker locations


<img width="396" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/72e7df66-da6e-46af-8d61-5e38ad394488">



Ensuring that any Windows Event logs are compiled into the Log Analytics Workspace I created

<img width="660" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/14ac25ed-add5-44a6-aa88-8fbcdd77e478">


Connecting the Log Analytics Workspace with the VM

<img width="403" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/5fdea932-c13d-47a3-abf8-148cb93509c6">


Added the Log Analytics Workspace to Microsoft Sentinel so the log data can be illustrated

<img width="224" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/35ff237f-4bee-4cb8-98e4-63dcf2620654">

Logged in to the Windows VM and viewed the Event Logs where I triggered an Audit Failure due to a failed logon attempt; the Source Network Address is the specifc field where the IP address of anyone who attempts to log in to the VM will be

<img width="594" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/e9d039c2-cf3e-4359-9d80-6e187432e2a0">

Pinging the VM from my machine but the requests are timing out due to the firewall on the VM. Requests from anyone else would also time out.

<img width="266" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/4a1add9d-331b-4dc7-b894-7776a75353ca">


For the purpose of the VM being discoverable, I turned off its firewall and now echo requests are allowed from my machine and others

<img width="197" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/75626a77-459b-405b-89ca-83eead81f9b7">

<img width="323" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/a4658513-d599-4dc8-a789-01517b742a05">

Placed a Powershell script in PowerShell ISE on the VM which will continuously check the Windows Event Viewer Logs for failed RDP login events. It will take the events and send them to an IP GeoLocation API, gathers the information provided by the API and places it in failed RDP log files.

<img width="414" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/6358af95-f1ed-4960-abaa-05818edc851c">

Here's a test file generated with data used to train Log Analytics Workspace to receive and analyze it along with a couple of failed login attempts from myself

<img width="708" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/ade64dc6-122e-47b5-8b95-b7f6fd7ef188">

Using the contents from the log file to ensure the entries are parsed

<img width="372" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/843b4f17-457b-40d8-a51a-fd8888f1d9b1">

Adding the correct collection path is critical as this is where will be searched for the logs

<img width="383" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/fc8e1a17-520c-4216-b99f-52d044442fcc">

Some time after adding the custom log to the Log Analytics Workspace I previously created, I ran a query on the log and saw results that inferred the VM was beginning to get attacked due to the custom log collecting failed RDP events

<img width="508" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/05cf6c32-257d-4314-9885-53776dee864d">

To visualize the data being logged and collected, I ran a KQL query to extract specific information from the failed RDP events and the total number of failed RDP events, assign it to specific values and used the values to configure a map of where the attacks are coming from in Microsoft Sentinel

<img width="639" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/506e77df-c8c2-4663-961f-c5e0e25bbe1a">

As attackers attempt to brute force the VM, their failed login attempts are being captured and placed into a failed RDP log file using the PowerShell script that is running on the VM

<img width="710" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/2cb52190-3fe8-4cb3-85c2-bb0652d5524b">

Visulization of where the attacks are coming from using the map created in Microsoft Sentinel

<img width="568" alt="image" src="https://github.com/ejone088/SIEM-Lab/assets/91700081/ce01c445-747e-4aab-b1f2-ec4b6001d53b">










